<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haikyuu!! Volleyball Card Game - Sandbox</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <!-- ============================================ -->
    <!-- LOGIN SCREEN -->
    <!-- ============================================ -->
    <div class="screen login-screen" id="login-screen">
        <div class="login-container">
            <h1 class="login-title">üèê Haikyuu!! Card Game üèê</h1>
            
            <!-- Login Form -->
            <div class="auth-form" id="login-form">
                <h2>ƒêƒÉng nh·∫≠p</h2>
                <input type="text" id="login-username" placeholder="T√™n ƒëƒÉng nh·∫≠p" class="auth-input" autocomplete="username">
                <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" class="auth-input" autocomplete="current-password">
                <div class="remember-me">
                    <input type="checkbox" id="remember-me" checked>
                    <label for="remember-me">Nh·ªõ t√†i kho·∫£n</label>
                </div>
                <button class="btn btn-login" id="btn-login">ƒêƒÉng nh·∫≠p</button>
                <p class="auth-switch">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-register">ƒêƒÉng k√Ω</a></p>
                <div class="auth-error hidden" id="login-error"></div>
            </div>
            
            <!-- Register Form -->
            <div class="auth-form hidden" id="register-form">
                <h2>ƒêƒÉng k√Ω</h2>
                <input type="text" id="register-username" placeholder="T√™n ƒëƒÉng nh·∫≠p (3-20 k√Ω t·ª±)" class="auth-input" autocomplete="username">
                <input type="text" id="register-displayname" placeholder="T√™n hi·ªÉn th·ªã (t√πy ch·ªçn)" class="auth-input">
                <input type="password" id="register-password" placeholder="M·∫≠t kh·∫©u (√≠t nh·∫•t 4 k√Ω t·ª±)" class="auth-input" autocomplete="new-password">
                <input type="password" id="register-password-confirm" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" class="auth-input" autocomplete="new-password">
                <button class="btn btn-register" id="btn-register">ƒêƒÉng k√Ω</button>
                <p class="auth-switch">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login">ƒêƒÉng nh·∫≠p</a></p>
                <div class="auth-error hidden" id="register-error"></div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- ONLINE LOBBY SCREEN -->
    <!-- ============================================ -->
    <div class="screen lobby-screen hidden" id="lobby-screen">
        <div class="lobby-container">
            <div class="lobby-header">
            <h1 class="lobby-title">üèê Haikyuu!! üèê<br>Card Game</h1>
                <div class="user-info">
                    <span class="user-name" id="logged-user-name">Player</span>
                    <button class="btn btn-logout" id="btn-logout">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
            
            <!-- Deck Selection -->
            <div class="deck-selection-section" id="deck-selection-section">
                <div class="deck-label">üì¶ Deck c·ªßa b·∫°n:</div>
                <div class="deck-select-buttons">
                    <select id="deck-select" class="deck-select">
                    </select>
                    <button class="btn btn-build-deck" id="btn-build-deck">Deck builder</button>
                </div>
                <div class="deck-info" id="deck-info">40 l√° | Karasuno</div>
            </div>
            
            <!-- Room Actions -->
            <div class="room-actions" id="room-actions">
                <button class="btn btn-create-room" id="btn-create-room">T·∫°o ph√≤ng m·ªõi</button>
                <button class="btn btn-show-rooms" id="btn-show-rooms">Danh s√°ch ph√≤ng</button>
            </div>
            
            <!-- Room List -->
            <div class="room-list-section hidden" id="room-list-section">
                <h3>üìã Ph√≤ng ƒëang ch·ªù</h3>
                <div class="room-list" id="room-list">
                    <div class="room-list-loading">ƒêang t·∫£i...</div>
                </div>
                <button class="btn btn-refresh-rooms" id="btn-refresh-rooms">üîÑ L√†m m·ªõi</button>
            </div>
            
            <!-- Waiting Room (shown after creating/joining) -->
            <div class="waiting-room hidden" id="waiting-room">
                <div class="player-slots">
                    <div class="player-slot" id="slot-p1">
                        <div class="slot-icon">üë§</div>
                        <div class="slot-label" id="slot-p1-name">ƒêang ch·ªù...</div>
                        <div class="slot-status" id="status-p1"></div>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="player-slot" id="slot-p2">
                        <div class="slot-icon">üë§</div>
                        <div class="slot-label" id="slot-p2-name">ƒêang ch·ªù...</div>
                        <div class="slot-status" id="status-p2"></div>
                    </div>
                </div>
                
                <div class="lobby-actions">
                    <button class="btn btn-start-game" id="btn-start-game" disabled>üèê B·∫Øt ƒë·∫ßu tr·∫≠n ƒë·∫•u</button>
                    <button class="btn btn-leave-room" id="btn-leave-room">üö™ R·ªùi ph√≤ng</button>
                </div>
            </div>

            <div class="lobby-info" id="lobby-info">T·∫°o ph√≤ng ho·∫∑c ch·ªçn t·ª´ danh s√°ch!</div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- DECK BUILDER MODAL -->
    <!-- ============================================ -->
    <div class="modal" id="deck-builder-modal">
        <div class="modal-content deck-builder-content">
            <div class="deck-builder-header">
                <h2>DECK BUILDER</h2>
                <div class="deck-counter">
                    <span id="deck-card-count">0</span>/40 l√°
                </div>
            </div>
            
            <div class="deck-builder-body">
                <!-- Card Collection -->
                <div class="card-collection">
                    <h3>B·ªô s∆∞u t·∫≠p th·∫ª</h3>
                    <div class="collection-filters">
                        <input type="text" id="filter-search" placeholder="üîç T√¨m t√™n th·∫ª..." class="filter-search">
                        <div class="filter-filters-row">
                            <select id="filter-school">
                                <option value="all">T·∫•t c·∫£ tr∆∞·ªùng</option>
                                <option value="Karasuno">Karasuno</option>
                                <option value="Shiratorizawa">Shiratorizawa</option>
                            </select>
                            <select id="filter-type">
                                <option value="all">T·∫•t c·∫£ lo·∫°i</option>
                                <option value="character">Nh√¢n v·∫≠t</option>
                                <option value="action">H√†nh ƒë·ªông</option>
                            </select>
                        </div>
                    </div>
                    <div class="collection-cards" id="collection-cards"></div>
                </div>
                
                <!-- Current Deck -->
                <div class="current-deck">
                    <h3>Deck hi·ªán t·∫°i</h3>
                    <div class="deck-cards" id="deck-cards"></div>
                </div>
            </div>
            
            <div class="deck-builder-footer">
                <select id="deck-name-select" class="deck-name-select">
                    <option value="new">New deck</option>
                </select>
                <div class="deck-builder-buttons">
                    <button class="btn btn-delete" id="btn-delete-deck" style="display: none;">X√≥a Deck</button>
                    <button class="btn btn-cancel" id="btn-cancel-deck">H·ªßy</button>
                    <button class="btn btn-confirm" id="btn-save-deck">L∆∞u Deck</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Card Preview Panel for Deck Builder - Outside modal -->
    <div class="card-preview-panel deck-builder-preview" id="deck-builder-preview-panel">
        <div class="preview-title">Xem tr∆∞·ªõc th·∫ª</div>
        <div class="preview-card" id="deck-builder-preview-card">
            <div class="preview-full-card" id="deck-builder-preview-full-card"></div>
            <div class="preview-name" id="deck-builder-preview-name">R√™ chu·ªôt v√†o th·∫ª</div>
            <div class="preview-school-class" id="deck-builder-preview-school-class"></div>
            <div class="preview-stats" id="deck-builder-preview-stats">
                <div class="preview-stat" data-stat="serve"><span>Giao:</span><span class="stat-value" data-stat="serve">-</span></div>
                <div class="preview-stat" data-stat="receive"><span>ƒê·ª°:</span><span class="stat-value" data-stat="receive">-</span></div>
                <div class="preview-stat" data-stat="toss"><span>Chuy·ªÅn:</span><span class="stat-value" data-stat="toss">-</span></div>
                <div class="preview-stat" data-stat="attack"><span>ƒê·∫≠p:</span><span class="stat-value" data-stat="attack">-</span></div>
                <div class="preview-stat" data-stat="block"><span>Ch·∫∑n:</span><span class="stat-value" data-stat="block">-</span></div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- GAME SCREEN -->
    <!-- ============================================ -->
    <div class="screen game-screen hidden" id="game-screen">
        <div class="game-container">

            <!-- Main Play Area -->
            <div class="play-area-wrapper">
                <div class="play-area">
                    <!-- Opponent Side (P2) -->
                    <div class="player-side opponent-side">
                        <div class="hand-section">
                            <div class="deck-wrapper">
                                <div class="deck-pile" id="p2-deck" tabindex="0" title="Click: R√∫t 1 l√° | Chu·ªôt ph·∫£i: Search/Shuffle">
                                    <span class="deck-count" id="p2-deck-count">40</span>
                                    <span class="deck-label">DECK</span>
                                </div>
                                <div class="action-area" id="p2-action-area">
                                    <div class="action-cards" id="p2-action-cards"></div>
                                </div>
                            </div>
                            <div class="hand-cards" id="p2-hand"></div>
                            <div class="discard-pile" id="p2-discard" title="Click: Xem Drop">
                                <span class="discard-label">DROP</span>
                            </div>
                        </div>

                        <div class="play-zones opponent-zones">
                            <div class="zone serve-zone" data-zone="serve" data-player="2">
                                <div class="zone-label" id="p2-serve-label">Giao</div>
                                <div class="zone-cards" id="p2-serve-cards"></div>
                                <div class="zone-spirit" data-player="2" data-zone="serve" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p2-serve-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                            <div class="zone receive-zone" data-zone="receive" data-player="2">
                                <div class="zone-label" id="p2-receive-label">ƒê·ª°</div>
                                <div class="zone-cards" id="p2-receive-cards"></div>
                                <div class="zone-spirit" data-player="2" data-zone="receive" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p2-receive-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                            <div class="zone toss-zone" data-zone="toss" data-player="2">
                                <div class="zone-label" id="p2-toss-label">Chuy·ªÅn</div>
                                <div class="zone-cards" id="p2-toss-cards"></div>
                                <div class="zone-spirit" data-player="2" data-zone="toss" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p2-toss-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                            <div class="zone attack-zone" data-zone="attack" data-player="2">
                                <div class="zone-label" id="p2-attack-label">ƒê·∫≠p</div>
                                <div class="zone-cards" id="p2-attack-cards"></div>
                                <div class="zone-spirit" data-player="2" data-zone="attack" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p2-attack-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Block Area (Center) -->
                    <div class="block-area">
                        <div class="block-controls">
                            <!-- Far Left: Score -->
                            <div class="block-edge-panel left-edge">
                                <div class="set-score-mini">
                                    <span class="player-tag p1" id="p1-name-tag">Player 1</span>
                                    <span class="score-box editable-score" id="p1-sets" contenteditable="true" title="Click ƒë·ªÉ ch·ªânh ƒëi·ªÉm">0</span>
                                    <span class="score-dash">-</span>
                                    <span class="score-box editable-score" id="p2-sets" contenteditable="true" title="Click ƒë·ªÉ ch·ªânh ƒëi·ªÉm">0</span>
                                    <span class="player-tag p2" id="p2-name-tag">Player 2</span>
                                </div>
                            </div>
                            
                            <!-- Center Group: Block Zone -->
                            <div class="block-center-group">
                                <div class="block-zone-container multi-block">
                                    <div class="block-label">CH·∫∂N</div>
                                    <div class="block-zone" id="p1-block-zone" data-player="1" data-zone="block">
                                        <div class="zone-cards multi-cards" id="p1-block-cards"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Far Right: Phase and Turn (clickable to advance) -->
                            <div class="block-edge-panel right-edge">
                                <div class="phase-display phase-clickable" id="current-phase" title="Click ƒë·ªÉ chuy·ªÉn phase">SERVE</div>
                                <div class="turn-indicator" id="turn-indicator">L∆∞·ª£t: P1</div>
                            </div>
                        </div>
                    </div>

                    <!-- My Side (P1) -->
                    <div class="player-side my-side">
                        <div class="hand-section">
                            <div class="deck-wrapper">
                                <div class="action-area" id="p1-action-area">
                                    <div class="action-cards" id="p1-action-cards"></div>
                                </div>
                                <div class="deck-pile" id="p1-deck" tabindex="0" title="Click: R√∫t 1 l√° | Chu·ªôt ph·∫£i: Search/Shuffle">
                                    <span class="deck-count" id="p1-deck-count">40</span>
                                    <span class="deck-label">DECK</span>
                                </div>
                            </div>
                            <div class="hand-cards" id="p1-hand"></div>
                            <div class="discard-pile" id="p1-discard" title="Click: Xem Drop">
                                <span class="discard-label">DROP</span>
                            </div>
                        </div>

                        <div class="play-zones my-zones">
                            <div class="zone serve-zone" data-zone="serve" data-player="1">
                                <div class="zone-label" id="p1-serve-label">Giao</div>
                                <div class="zone-cards" id="p1-serve-cards"></div>
                                <div class="zone-spirit" data-player="1" data-zone="serve" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p1-serve-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                            <div class="zone receive-zone" data-zone="receive" data-player="1">
                                <div class="zone-label" id="p1-receive-label">ƒê·ª°</div>
                                <div class="zone-cards" id="p1-receive-cards"></div>
                                <div class="zone-spirit" data-player="1" data-zone="receive" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p1-receive-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                            <div class="zone toss-zone" data-zone="toss" data-player="1">
                                <div class="zone-label" id="p1-toss-label">Chuy·ªÅn</div>
                                <div class="zone-cards" id="p1-toss-cards"></div>
                                <div class="zone-spirit" data-player="1" data-zone="toss" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p1-toss-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                            <div class="zone attack-zone" data-zone="attack" data-player="1">
                                <div class="zone-label" id="p1-attack-label">ƒê·∫≠p</div>
                                <div class="zone-cards" id="p1-attack-cards"></div>
                                <div class="zone-spirit" data-player="1" data-zone="attack" title="Click: Xem √ù ch√≠">
                                    <span class="spirit-count" id="p1-attack-spirit">0</span>
                                    <span class="spirit-label">√ù ch√≠</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card Preview Panel -->
                <div class="card-preview-panel" id="card-preview-panel">
                    <div class="preview-title">Xem tr∆∞·ªõc th·∫ª</div>
                    <div class="preview-card" id="preview-card">
                        <div class="preview-full-card" id="preview-full-card"></div>
                        <div class="preview-name" id="preview-name">R√™ chu·ªôt v√†o th·∫ª</div>
                        <div class="preview-school-class" id="preview-school-class"></div>
                        <div class="preview-stats" id="preview-stats">
                            <div class="preview-stat" data-stat="serve"><span>Giao:</span><span class="stat-value" data-stat="serve">-</span></div>
                            <div class="preview-stat" data-stat="receive"><span>ƒê·ª°:</span><span class="stat-value" data-stat="receive">-</span></div>
                            <div class="preview-stat" data-stat="toss"><span>Chuy·ªÅn:</span><span class="stat-value" data-stat="toss">-</span></div>
                            <div class="preview-stat" data-stat="attack"><span>ƒê·∫≠p:</span><span class="stat-value" data-stat="attack">-</span></div>
                            <div class="preview-stat" data-stat="block"><span>Ch·∫∑n:</span><span class="stat-value" data-stat="block">-</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat/Log Box -->
            <div class="chat-log-box" id="chat-log-box">
                <div class="chat-log-header">
                    <span>Chat & Log</span>
                </div>
                <div class="chat-log-messages" id="chat-log-messages"></div>
                <div class="chat-log-input-container">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." maxlength="200">
                    <button id="chat-send-btn" class="chat-send-btn">G·ª≠i</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal b·∫Øt ƒë·∫ßu game -->
    <div class="modal" id="game-start-modal">
        <div class="modal-content">
            <h2>üèê Tr·∫≠n ƒë·∫•u b·∫Øt ƒë·∫ßu! üèê</h2>
            <p id="first-player-text">ƒêang ch·ªù...</p>
            <button class="btn btn-start-game" id="btn-close-start-modal">B·∫Øt ƒë·∫ßu</button>
        </div>
    </div>

    <!-- Modal k·∫øt th√∫c game -->
    <div class="modal" id="game-over-modal">
        <div class="modal-content">
            <h2 id="winner-text">üéâ Ch√∫c m·ª´ng! üéâ</h2>
            <p id="final-score"></p>
            <button class="btn btn-start-game" onclick="location.reload()">Ch∆°i l·∫°i</button>
        </div>
    </div>

    <!-- Spirit Cards Modal -->
    <div class="modal" id="spirit-modal">
        <div class="modal-content spirit-modal-content">
            <h2 id="spirit-title">Danh s√°ch √ù ch√≠</h2>
            <div class="spirit-card-list" id="spirit-card-list"></div>
            <button class="btn btn-confirm" id="btn-close-spirit">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Deck Search Modal -->
    <div class="modal" id="deck-search-modal">
        <div class="modal-content deck-search-content">
            <h2 id="deck-search-title">üîç T√¨m ki·∫øm trong Deck</h2>
            <div class="deck-search-cards" id="deck-search-cards"></div>
            <div class="deck-search-buttons">
                <button class="btn btn-cancel" id="btn-shuffle-deck">üîÄ X√°o b√†i</button>
                <button class="btn btn-confirm" id="btn-close-deck-search">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Discard View Modal -->
    <div class="modal" id="discard-modal">
        <div class="modal-content discard-modal-content">
            <h2 id="discard-title">üì§ Drop Zone</h2>
            <div class="discard-card-list" id="discard-card-list"></div>
            <button class="btn btn-confirm" id="btn-close-discard">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Action Cards Modal -->
    <div class="modal" id="action-cards-modal">
        <div class="modal-content discard-modal-content">
            <h2 id="action-cards-title">‚ö° Khu h√†nh ƒë·ªông</h2>
            <div class="discard-card-list" id="action-cards-list"></div>
            <button class="btn btn-confirm" id="btn-close-action-cards">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Context Menu for Cards -->
    <div class="context-menu hidden" id="card-context-menu">
        <div class="context-menu-title" id="context-menu-title">Di chuy·ªÉn th·∫ª</div>
        <div class="context-menu-section">
            <div class="context-menu-item has-submenu" data-action="spirit-parent">
                <span>üìç V√†o √ù ch√≠</span>
                <span class="submenu-arrow">‚ñ∂</span>
                <div class="context-submenu">
                    <div class="context-menu-item" data-action="spirit-serve">√ù ch√≠ Giao</div>
                    <div class="context-menu-item" data-action="spirit-receive">√ù ch√≠ ƒê·ª°</div>
                    <div class="context-menu-item" data-action="spirit-toss">√ù ch√≠ Chuy·ªÅn</div>
                    <div class="context-menu-item" data-action="spirit-attack">√ù ch√≠ ƒê·∫≠p</div>
                </div>
            </div>
            <div class="context-menu-item" data-action="to-hand">‚úã V·ªÅ tay</div>
            <div class="context-menu-item" data-action="to-drop">üì§ V√†o Drop</div>
            <div class="context-menu-item" data-action="to-action" id="context-to-action" style="display: none;">‚ö° V√†o khu H√†nh ƒë·ªông</div>
            <div class="context-menu-item" data-action="to-deck-top">üìö L√™n ƒë·∫ßu Deck</div>
            <div class="context-menu-item" data-action="to-deck-bottom">üìö Xu·ªëng cu·ªëi Deck</div>
        </div>
    </div>

    <!-- Context Menu for Deck -->
    <div class="context-menu hidden" id="deck-context-menu">
        <div class="context-menu-title" id="deck-context-menu-title">Deck</div>
        <div class="context-menu-section">
            <div class="context-menu-item" data-action="search-deck">üîç Search Deck</div>
            <div class="context-menu-item" data-action="shuffle-deck">üîÄ Shuffle</div>
            <div class="context-menu-item" data-action="mill-deck">üì§ Mill 1</div>
        </div>
    </div>
    
    <!-- Online Game Manager -->
    <script src="online.js"></script>
    
    <!-- Main Game Logic -->
    <script src="game.js"></script>
</body>
</html>
